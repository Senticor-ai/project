# Per-workload secrets: minimise secret exposure surface.
#
# Each workload receives only the secrets it actually needs.
# The canonical app-secrets resource is kept for backward-compatibility
# and is referenced only by the backend (which needs almost all secrets).
#
# Workload secret requirements:
#   backend       — POSTGRES_PASSWORD, JWT_SECRET, GMAIL_CLIENT_ID,
#                   GMAIL_CLIENT_SECRET, GMAIL_STATE_SECRET, ENCRYPTION_KEY,
#                   VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY
#   worker        — POSTGRES_PASSWORD, ENCRYPTION_KEY
#   push-worker   — POSTGRES_PASSWORD, VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY
#   watch-worker  — POSTGRES_PASSWORD, ENCRYPTION_KEY, GMAIL_CLIENT_ID,
#                   GMAIL_CLIENT_SECRET
#   agents        — OPENROUTER_API_KEY
#   frontend      — (none)
#   storybook     — (none)
#
# NOTE: Values below are SOPS-encrypted placeholders.  After initial deploy,
# encrypt with: sops --encrypt --in-place secrets-per-workload.yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: worker-secrets
type: Opaque
stringData:
  POSTGRES_PASSWORD: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
  ENCRYPTION_KEY: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
---
apiVersion: v1
kind: Secret
metadata:
  name: push-worker-secrets
type: Opaque
stringData:
  POSTGRES_PASSWORD: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
  VAPID_PUBLIC_KEY: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
  VAPID_PRIVATE_KEY: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
---
apiVersion: v1
kind: Secret
metadata:
  name: watch-worker-secrets
type: Opaque
stringData:
  POSTGRES_PASSWORD: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
  ENCRYPTION_KEY: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
  GMAIL_CLIENT_ID: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
  GMAIL_CLIENT_SECRET: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
---
apiVersion: v1
kind: Secret
metadata:
  name: agents-secrets
type: Opaque
stringData:
  OPENROUTER_API_KEY: ENC[AES256_GCM,data:PLACEHOLDER,type:str]
