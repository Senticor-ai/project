import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="Flows/Collect to Engage" />

# Flow: Collect â†’ Process â†’ Organize â†’ Review â†’ Engage

This document traces the complete task lifecycle through Terminandoyo's
Paperclip components, from the moment a thought enters the system to the
moment it's acted upon.

---

## Overview

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ COLLECT  â”‚â”€â”€â”€â”€â–¶â”‚ TRIAGE   â”‚â”€â”€â”€â”€â–¶â”‚ ORGANIZE â”‚
   â”‚          â”‚     â”‚          â”‚     â”‚          â”‚
   â”‚ Inbox    â”‚     â”‚ Inline   â”‚     â”‚ Route to â”‚
   â”‚ Capture  â”‚     â”‚ actions  â”‚     â”‚ bucket   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                    â”‚  ENGAGE  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚          â”‚           â”‚
                    â”‚ Work fromâ”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ lists    â”‚â—€â”€â”€â”€â”€â”‚ REVIEW   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚          â”‚
                                     â”‚ Weekly + â”‚
                                     â”‚ daily    â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: Collect

**Component**: `InboxCapture` â†’ `InboxList`

**User story**: "I just had a thought during a meeting. I need to capture it
before I forget, without disrupting the meeting."

**Flow**:

1. User opens the app â†’ InboxCapture input is always visible at top
2. Types: "Anruf bei Frau MÃ¼ller wegen Fahrkostenantrag"
3. Presses Enter â†’ item created with:
   - `CaptureSource: { kind: "thought" }`
   - `confidence: "low"`
   - `needsEnrichment: true`
   - `provenance.history: [{ action: "created", timestamp: now }]`
4. Input clears, item appears at top of inbox list (newest first)
5. Count badge on BucketNav inbox icon increments

**Paperclip interactions**:

- New card enters inbox with a soft slide-down animation
- Card surface is paper-50 (lightest) indicating "raw, unprocessed"
- ConfidenceBadge shows "low" (alert icon)

**Data created**: `InboxItem` with canonical ID `urn:app:inbox:{uuid}`

---

## Phase 2: Triage (Inline Processing)

**Components**: `InboxList` â†’ `InboxTriage` (inline on each card)

**User story**: "Time to process my inbox. The newest item is at the top â€” I'll
quickly sort each one into the right bucket."

**Design principle**: No multi-step dialog. Triage is a one-tap operation with
optional details. Users move items directly into buckets, assign to projects,
add dates, or apply labels â€” all inline on the card.

**Flow**:

1. The **first** (newest) item in InboxList auto-expands with the triage action bar
2. User sees inline bucket buttons directly on the card:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¥ Inbox                          â— Low â”‚
â”‚                                          â”‚
â”‚ Anruf bei Frau MÃ¼ller wegen              â”‚
â”‚ Fahrkostenantrag                         â”‚
â”‚ via meeting                              â”‚
â”‚                                          â”‚
â”‚ [âš¡ Next] [â³ Waiting] [ğŸ“… Calendar]     â”‚
â”‚ [â˜ï¸ Someday] [ğŸ“– Reference] [Archive]    â”‚
â”‚                                          â”‚
â”‚ â–¾ More options                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

3. **Quick triage**: Tap a bucket button â†’ item moves there immediately
4. **With details**: Click "More options" to expand:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–´ Less options                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ Assign to project                â”‚ â”‚
â”‚ â”‚ [Website Redesign        â–¾]         â”‚ â”‚
â”‚ â”‚                                      â”‚ â”‚
â”‚ â”‚ ğŸ“… Date                             â”‚ â”‚
â”‚ â”‚ [2026-02-10]                        â”‚ â”‚
â”‚ â”‚                                      â”‚ â”‚
â”‚ â”‚ Labels / contexts                    â”‚ â”‚
â”‚ â”‚ [@phone] [Add...]                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚ [âš¡ Next] [â³ Waiting] [ğŸ“… Calendar]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

5. User taps a bucket â†’ `TriageResult` produced:
   - Inbox item is removed (archived with provenance)
   - New `Action` created in target bucket
   - If project assigned, action linked via `part_of` reference
   - If date set, `scheduledDate` populated
   - If contexts added, stored on the action
   - Confidence upgraded to "high", `needsEnrichment` set to false
   - Provenance records: `{ action: "clarified", from: "inbox", to: "next" }`

**Paperclip interactions**:

- Triage bar is always visible on the first card (no click to reveal)
- "More options" expands with a smooth slide animation (Framer Motion)
- On bucket tap: card slides out, item appears in target bucket
- Bucket buttons use bucket colors for instant visual recognition

---

## Phase 3: Organize

**Components**: `ProjectTree`, `ActionList`, `WaitingForList`, `CalendarView`

After processing, items live in their appropriate buckets.

### If single action â†’ Next

The action appears in `ActionList` with:

- Context chips (if assigned during clarification)
- Energy/time estimates (from ComputationPort, if provided)
- Focus star (if manually starred)

### If project â†’ Project Tree

A new `Project` is created with:

- `desiredOutcome` from DefinitionPort
- First action as `actionIds[0]`
- `status: "active"`

Subsequent inbox items can be routed to this project during clarification.

### If delegated â†’ Waiting

An action with `bucket: "waiting"` and `delegatedTo` set appears in `WaitingForList`:

- Grouped under the delegate's name
- Follow-up date tracked
- TypedReference: `{ type: "delegates_to", targetId: personId }`

### If scheduled â†’ Calendar

An action with `scheduledDate` appears in `CalendarView`:

- Positioned on the correct date
- Time slot if `scheduledTime` is set
- Recurring items show cycle icon

---

## Phase 4: Review

**Component**: `ReviewDashboard`

### Weekly Review Flow

**User story**: "It's Friday afternoon. Time for my weekly review."

1. User navigates to Review â†’ `ReviewDashboard` opens
2. 7-step guided wizard:

| Step          | Component Used                | What User Does                 |
| ------------- | ----------------------------- | ------------------------------ |
| Clear Inbox   | `InboxList` + `InboxTriage`   | Triage remaining items         |
| Next          | `ActionList` (filtered: next) | Mark done, reschedule, archive |
| Projects      | `ProjectTree` (each project)  | Ensure each has a next action  |
| Waiting       | `WaitingForList`              | Follow up on overdue items     |
| Later         | `SomedayList`                 | Promote or archive             |
| Calendar      | `CalendarView` (next 2 weeks) | Confirm upcoming commitments   |
| Set Focus     | `FocusList`                   | Star/unstar items for the week |

3. Each step shows relevant items with action buttons
4. Progress bar fills as steps complete
5. Final step: celebration + summary ("Reviewed 47 items, completed 8, delegated 3")

### Daily Review Flow

A lighter version:

1. Check inbox (should be near-zero)
2. Scan today's calendar
3. Review focus list
4. Pick 3-5 items for today

---

## Phase 5: Engage

**Components**: `ActionList` + `ContextFilterBar` + `FocusList`

**User story**: "I'm at my desk with 30 minutes before a meeting. What
should I do?"

**Flow**:

1. User opens ActionList (or taps BucketNav â†’ Next)
2. Context filter: selects `@computer` (they're at their desk)
3. Time filter: "I have 30 min"
4. Energy filter: "Medium" (it's mid-afternoon)
5. List narrows to 4 matching actions
6. User picks the focused item (star icon), works on it
7. Completes it â†’ card slides out with satisfying animation
8. If part of a project â†’ next sequential action auto-promotes

**Paperclip interactions**:

- Filter chips toggle with snap animation
- Matching actions fade in, non-matching fade out (not removed, just dimmed)
- Complete action: checkmark â†’ strikethrough â†’ slide out
- Auto-sequence: next project action slides up from dimmed to full opacity

---

## Cross-cutting Concerns

### Provenance Trail

Every action in every phase is recorded in the item's `provenance.history`:

```typescript
// Capture
{ action: "created", timestamp: "2026-02-06T10:30:00Z" }

// Clarify
{ action: "clarified", from: "inbox", to: "next", timestamp: "..." }

// Organize (moved between buckets)
{ action: "moved", from: "next", to: "waiting", note: "Delegated to Sarah" }

// Engage (completed)
{ action: "completed", timestamp: "2026-02-07T14:15:00Z" }
```

Visible via `HoverInspector` on any ObjectCard.

### Confidence Lifecycle

```
Capture:  confidence = "low",    needsEnrichment = true
Triage:   confidence = "high",   needsEnrichment = false
Stalled:  confidence = "medium", needsEnrichment = true  (missing next action)
Enriched: confidence = "high",   needsEnrichment = false (details filled in)
```

### No-Delete Policy

- "Archive" replaces "Delete" everywhere
- Archived items set `provenance.archivedAt` but remain in the system
- Provenance history is append-only â€” no entries are ever removed
- UI shows "Archive" buttons, never "Delete"

---

## Component Interaction Map

```
InboxCapture â”€â”€createsâ”€â”€â–¶ InboxItem
     â”‚
     â–¼
InboxList â”€â”€containsâ”€â”€â–¶ InboxTriage (inline on first item)
     â”‚                      â”‚
     â”‚                      â”œâ”€â”€bucket tapâ”€â”€â–¶ Action â”€â”€â–¶ ActionList
     â”‚                      â”‚                   â”‚
     â”‚                      â”‚                   â”œâ”€â”€â–¶ ProjectTree (if project assigned)
     â”‚                      â”‚                   â”œâ”€â”€â–¶ WaitingForList (if waiting)
     â”‚                      â”‚                   â””â”€â”€â–¶ CalendarView (if calendar)
     â”‚                      â”‚
     â”‚                      â”œâ”€â”€referenceâ”€â”€â”€â–¶ ReferenceLibrary
     â”‚                      â”œâ”€â”€somedayâ”€â”€â”€â”€â”€â–¶ SomedayList
     â”‚                      â””â”€â”€archiveâ”€â”€â”€â”€â”€â–¶ Archive
     â”‚
     â–¼
BucketNav â”€â”€navigatesâ”€â”€â–¶ [all bucket views]
     â”‚
     â–¼
FocusList â”€â”€filtersâ”€â”€â–¶ Action/Project (isFocused === true)
     â”‚
     â–¼
ReviewDashboard â”€â”€iteratesâ”€â”€â–¶ [all bucket views in sequence]
     â”‚
     â–¼
GoalTracker â”€â”€linksâ”€â”€â–¶ Projects + Actions (via refers_to)
```
