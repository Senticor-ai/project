{
  "feature": "Add Tooltip component and integrate across UI",
  "description": "Resolve PR #34: Create a portal-based Tooltip component with delay, placement, and aria-label derivation. Integrate into ActionRow (5 buttons), ProjectTree (6 elements), ReferenceRow (7 elements), AppHeader (1 button), ChatInput (1 button). Includes unit tests, integration tests, Storybook stories, and housekeeping changes.",
  "created_at": "2026-02-24T10:32:07.578Z",
  "updated_at": "2026-02-24T11:11:57.112Z",
  "status": "human_review",
  "planStatus": "review",
  "xstateState": "human_review",
  "executionPhase": "complete",
  "lastEvent": {
    "eventId": "377b2793-ce89-456d-b2f6-d39dbaf180f8",
    "sequence": 1,
    "type": "PLANNING_COMPLETE",
    "timestamp": "2026-02-24T10:54:07.905478+00:00"
  },
  "workflow_type": "feature",
  "workflow_rationale": "New reusable UI component (Tooltip) added to the design system with broad integration across 5 existing components. Pure additive frontend feature — no backend, no infrastructure, no data model changes.",
  "phases": [
    {
      "id": "phase-1-tooltip-component",
      "name": "Core Tooltip Component",
      "type": "implementation",
      "description": "Create the Tooltip component with portal-based rendering, delay/cancel, placement (top/bottom with auto-flip), and automatic aria-label derivation. Includes unit tests and Storybook stories.",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create Tooltip component (Tooltip.tsx) with portal rendering, delay, placement, aria-label derivation, and unit tests (Tooltip.test.tsx) covering all 8 test cases",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/components/ui/Tooltip.tsx",
            "frontend/src/components/ui/Tooltip.test.tsx"
          ],
          "patterns_from": [
            "frontend/src/components/ui/Icon.tsx",
            "frontend/src/components/ui/Icon.test.tsx"
          ],
          "implementation_details": {
            "component_api": {
              "props": "label?: string, placement?: 'top' | 'bottom' (default 'top'), delay?: number (default 400), children: ReactNode, className?: string",
              "hooks": "useState, useRef, useEffect, useId, useCallback",
              "rendering": "createPortal to document.body, wrapping span with className='inline-flex'",
              "aria_derivation": "Search child elements for aria-label attribute at interaction time (in show callback), not during render",
              "positioning": "getBoundingClientRect, centered horizontally, viewport-clamped (4px margin), auto-flip top→bottom if insufficient space"
            },
            "test_cases": [
              "Renders children without tooltip (no label, no aria-label → no tooltip popup)",
              "Derives label from aria-label on child element",
              "Explicit label prop overrides derived aria-label",
              "Shows tooltip after hover delay (400ms default)",
              "Hides tooltip on mouse leave",
              "Cancels if leave before delay fires",
              "Shows on focus, hides on blur (keyboard accessibility)",
              "Respects custom delay prop"
            ],
            "test_patterns": {
              "timers": "vi.useFakeTimers({ shouldAdvanceTime: true }) in beforeEach, vi.useRealTimers() in afterEach",
              "hover_target": "screen.getByLabelText('...').closest('span')! — hover the wrapping span, not the button",
              "timer_advance": "act(() => { vi.advanceTimersByTime(400); })",
              "assertion": "screen.getByRole('tooltip')"
            },
            "styling": {
              "tooltip_classes": "fixed z-50 rounded-[var(--radius-sm)] bg-text px-2 py-1 text-xs text-surface shadow-[var(--shadow-card)]",
              "wrapper_classes": "inline-flex"
            }
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && CI=1 npx vitest run --project=unit -- src/components/ui/Tooltip.test.tsx",
            "expected": "8 tests pass"
          },
          "status": "completed",
          "notes": "Created Tooltip.tsx and Tooltip.test.tsx. All 8 unit tests pass. All 1276 existing tests still pass. Committed as 85786bc.",
          "updated_at": "2026-02-24T10:55:47.827553+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Create Tooltip Storybook stories (Tooltip.stories.tsx) with 4 variants: Default, DerivedFromAriaLabel, BottomPlacement, IconButtonRow",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "frontend/src/components/ui/Tooltip.stories.tsx"
          ],
          "patterns_from": [
            "frontend/src/components/ui/Icon.stories.tsx"
          ],
          "implementation_details": {
            "meta": {
              "title": "Primitives/Tooltip",
              "component": "Tooltip",
              "parameters": "{ layout: 'centered' }"
            },
            "stories": [
              "Default: Tooltip with explicit label='Archive' wrapping an archive Icon button",
              "DerivedFromAriaLabel: Tooltip wrapping <button aria-label='Star project'> — derives text automatically",
              "BottomPlacement: Tooltip with placement='bottom' showing below trigger",
              "IconButtonRow: Row of 4 icon buttons each wrapped with Tooltip, demonstrating real-world usage pattern"
            ]
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && npx tsc -b --noEmit",
            "expected": "No TypeScript errors"
          },
          "status": "completed",
          "notes": "Created Tooltip.stories.tsx with 4 variants: Default, DerivedFromAriaLabel, BottomPlacement, IconButtonRow. TypeScript check passes.",
          "updated_at": "2026-02-24T10:57:38.315445+00:00"
        }
      ]
    },
    {
      "id": "phase-2-actionrow-integration",
      "name": "ActionRow Tooltip Integration",
      "type": "implementation",
      "description": "Wrap 5 icon buttons in ActionRow with Tooltip and add tooltip integration tests. Buttons: complete checkbox, focus star, notes indicator (expanded), edit/collapse, move menu.",
      "depends_on": [
        "phase-1-tooltip-component"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Wrap ActionRow icon buttons with Tooltip (complete, focus, edit/collapse, move menu) and add 'ActionRow tooltip integration' test block with 5 tests",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/components/work/ActionRow.tsx",
            "frontend/src/components/work/ActionRow.test.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/components/work/ActionRow.tsx",
            "frontend/src/components/work/ActionRow.test.tsx"
          ],
          "implementation_details": {
            "import_addition": "import { Tooltip } from '@/components/ui/Tooltip';",
            "buttons_to_wrap": [
              "Complete checkbox button (line ~230, aria-label='Complete/Completed: {name}')",
              "Focus star button (line ~249, aria-label='Focus/Unfocus {name}')",
              "Edit/Collapse button (line ~365, aria-label='Edit/Collapse {name}')",
              "Move menu button (line ~379, aria-label='Move {name}')"
            ],
            "wrapping_pattern": "<Tooltip>\n  <button aria-label=\"...\">...</button>\n</Tooltip>",
            "notes": "The notes indicator button (line ~316) is conditional (expanded + description). Also wrap it with <Tooltip> when present.",
            "test_cases": [
              "Complete button shows tooltip on hover (advance 400ms, check role='tooltip')",
              "Focus star shows tooltip on hover",
              "Edit button shows tooltip on hover",
              "Move menu button shows tooltip on hover",
              "Tooltip hides on mouse leave"
            ],
            "test_setup": "vi.useFakeTimers({ shouldAdvanceTime: true }) in beforeEach, vi.useRealTimers() in afterEach"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && CI=1 npx vitest run --project=unit -- src/components/work/ActionRow.test.tsx",
            "expected": "All existing + new tooltip integration tests pass"
          },
          "status": "completed",
          "notes": "Wrapped 4 ActionRow icon buttons (complete, focus, edit/collapse, move menu) with Tooltip component. Added 5 tests: 4 verify wrapper presence, 1 verifies tooltip text on hover. All 1281 tests pass.",
          "updated_at": "2026-02-24T11:00:46.717613+00:00"
        }
      ]
    },
    {
      "id": "phase-3-projecttree-integration",
      "name": "ProjectTree Tooltip Integration",
      "type": "implementation",
      "description": "Wrap 6 elements in ProjectTree with Tooltip and add tooltip integration tests. Elements: show all toggle, create project, stalled indicator (explicit label), archive, rename, star.",
      "depends_on": [
        "phase-1-tooltip-component"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Wrap ProjectTree elements with Tooltip (show all, create project, stalled indicator with explicit label='Needs next action', archive, rename, star) and add 'ProjectTree tooltip integration' test block with 3 tests",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/components/work/ProjectTree.tsx",
            "frontend/src/components/work/ProjectTree.test.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/components/work/ProjectTree.tsx",
            "frontend/src/components/work/ProjectTree.test.tsx"
          ],
          "implementation_details": {
            "import_addition": "import { Tooltip } from '@/components/ui/Tooltip';",
            "elements_to_wrap": [
              "Show all/active toggle button (line ~97, aria-label='Show active only' / 'Show all projects')",
              "Create project button (line ~116, aria-label='Create project')",
              "Stalled indicator span (line ~352, SPECIAL: use explicit label='Needs next action')",
              "Archive project button (line ~364, aria-label='Archive {name}')",
              "Rename project button (line ~375, aria-label='Rename {name}')",
              "Star toggle button (line ~387, aria-label='Star/Unstar {name}')"
            ],
            "special_case": "Stalled indicator: <Tooltip label=\"Needs next action\"><span role=\"img\" aria-label=\"Needs next action\">...</span></Tooltip>",
            "test_cases": [
              "Star button shows tooltip on hover",
              "Archive button shows tooltip on hover",
              "Create project button shows tooltip on hover"
            ],
            "test_setup": "vi.useFakeTimers({ shouldAdvanceTime: true }) in beforeEach, vi.useRealTimers() in afterEach"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && CI=1 npx vitest run --project=unit -- src/components/work/ProjectTree.test.tsx",
            "expected": "All existing + new tooltip integration tests pass"
          },
          "status": "completed",
          "notes": "Wrapped 6 elements with Tooltip (show all, create project, stalled indicator with explicit label, archive, rename, star). Added 3 tooltip integration tests. All 1284 tests pass.",
          "updated_at": "2026-02-24T11:03:21.117616+00:00"
        }
      ]
    },
    {
      "id": "phase-4-referencerow-integration",
      "name": "ReferenceRow Tooltip Integration",
      "type": "implementation",
      "description": "Wrap 7 elements in ReferenceRow with Tooltip. Elements: notes indicator, external link, view file, download, actions menu, view markdown, edit content.",
      "depends_on": [
        "phase-1-tooltip-component"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Wrap ReferenceRow icon buttons/links with Tooltip (notes indicator, external link, view file, download, actions menu, view markdown, edit content toggle buttons)",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/components/work/ReferenceRow.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/components/work/ReferenceRow.tsx",
            "frontend/src/components/work/ActionRow.tsx"
          ],
          "implementation_details": {
            "import_addition": "import { Tooltip } from '@/components/ui/Tooltip';",
            "elements_to_wrap": [
              "Notes indicator button (line ~215, aria-label='Show notes for {name}')",
              "External URL link (line ~228, aria-label='Open external link')",
              "View file link (line ~241, aria-label='View file')",
              "Download file link (line ~254, aria-label='Download file')",
              "Actions menu button (line ~269, aria-label='Actions for {name}')",
              "View markdown button (line ~331, aria-label='View markdown')",
              "Edit content button (line ~342, aria-label='Edit content')"
            ],
            "wrapping_pattern_for_links": "<Tooltip><a aria-label=\"...\">...</a></Tooltip>"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && npx tsc -b --noEmit && npx eslint src/components/work/ReferenceRow.tsx",
            "expected": "No TypeScript or ESLint errors"
          },
          "status": "completed",
          "notes": "Wrapped all icon buttons/links in ReferenceRow with Tooltip: notes indicator, external link, view file, download, actions menu, view markdown, and edit content toggle buttons. Verification passed.",
          "updated_at": "2026-02-24T11:05:05.538518+00:00"
        }
      ]
    },
    {
      "id": "phase-5-appheader-chatinput-integration",
      "name": "AppHeader & ChatInput Tooltip Integration",
      "type": "implementation",
      "description": "Wrap AppHeader chat toggle button and ChatInput send button with Tooltip. Add AppHeader tooltip integration tests.",
      "depends_on": [
        "phase-1-tooltip-component"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Wrap AppHeader chat toggle button with Tooltip and add 'AppHeader chat toggle' test block with 4 tests (render, click, minimize label, tooltip hover)",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/components/shell/AppHeader.tsx",
            "frontend/src/components/shell/AppHeader.test.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/components/shell/AppHeader.tsx",
            "frontend/src/components/shell/AppHeader.test.tsx"
          ],
          "implementation_details": {
            "import_addition": "import { Tooltip } from '@/components/ui/Tooltip';",
            "button_to_wrap": "Chat toggle button in AppHeaderControls (line ~149, aria-label='Chat minimieren' / 'Chat mit Copilot')",
            "test_cases": [
              "Chat toggle button renders when onToggleChat provided",
              "Click calls onToggleChat callback",
              "Shows 'Chat minimieren' label when chat is open (isChatOpen=true)",
              "Shows tooltip on hover after 400ms delay"
            ],
            "test_setup": "vi.useFakeTimers({ shouldAdvanceTime: true }) in beforeEach for tooltip test, vi.useRealTimers() in afterEach"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && CI=1 npx vitest run --project=unit -- src/components/shell/AppHeader.test.tsx",
            "expected": "All existing + new tooltip tests pass"
          },
          "status": "completed",
          "notes": "Wrapped chat toggle button with Tooltip component (derives label from aria-label). Added 4 tests: render, click, minimize label, tooltip hover. All 1288 tests pass.",
          "updated_at": "2026-02-24T11:06:40.211248+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Wrap ChatInput send button with Tooltip",
          "service": "frontend",
          "files_to_modify": [
            "frontend/src/components/chat/ChatInput.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "frontend/src/components/chat/ChatInput.tsx"
          ],
          "implementation_details": {
            "import_addition": "import { Tooltip } from '@/components/ui/Tooltip';",
            "button_to_wrap": "Send button (line ~45, aria-label='Senden')",
            "wrapping_pattern": "<Tooltip><button aria-label=\"Senden\" ...>...</button></Tooltip>"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && npx tsc -b --noEmit && npx eslint src/components/chat/ChatInput.tsx",
            "expected": "No TypeScript or ESLint errors"
          },
          "status": "completed",
          "notes": "Wrapped ChatInput send button with Tooltip component. Tooltip derives label from existing aria-label=\"Senden\".",
          "updated_at": "2026-02-24T11:08:08.550655+00:00"
        }
      ]
    },
    {
      "id": "phase-6-housekeeping",
      "name": "Housekeeping & Docs",
      "type": "implementation",
      "description": "Create MDX product doc, update .gitignore and .claude/settings.json per PR #34 scope.",
      "depends_on": [
        "phase-1-tooltip-component"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Create EpicEmailPreviewEnhancements.mdx product doc and update .gitignore (remove auto-claude entries) and .claude/settings.json (add git pull permission)",
          "service": "frontend",
          "files_to_modify": [
            ".gitignore",
            ".claude/settings.json"
          ],
          "files_to_create": [
            "frontend/src/docs/product/EpicEmailPreviewEnhancements.mdx"
          ],
          "patterns_from": [
            "frontend/src/docs/product/EpicExport.mdx",
            "frontend/src/docs/product/EpicPwaReadiness.mdx"
          ],
          "implementation_details": {
            "mdx_doc": "Planning-only product spec for Email Preview Enhancements epic. Follow existing Epic MDX doc patterns (title, meta, description structure).",
            "gitignore_changes": "Remove 11 auto-claude-related entries as specified in PR diff",
            "settings_changes": "Add 'Bash(git pull:*)' to permissions.allow array"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && npx tsc -b --noEmit",
            "expected": "No TypeScript errors including new MDX"
          },
          "status": "completed",
          "notes": "Created EpicEmailPreviewEnhancements.mdx following existing epic doc patterns. Removed .auto-claude/ from .gitignore. Added git pull permission to .claude/settings.json. TypeScript verification passed.",
          "updated_at": "2026-02-24T11:09:53.622447+00:00"
        }
      ]
    },
    {
      "id": "phase-7-verification",
      "name": "Final Verification",
      "type": "integration",
      "description": "Run full preflight check suite to verify no regressions, all tests pass, and code quality checks are green.",
      "depends_on": [
        "phase-2-actionrow-integration",
        "phase-3-projecttree-integration",
        "phase-4-referencerow-integration",
        "phase-5-appheader-chatinput-integration",
        "phase-6-housekeeping"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Run full preflight checks: TypeScript compilation, ESLint, Prettier, all unit tests, and Storybook build to verify no regressions",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "implementation_details": {
            "commands": [
              "cd frontend && npx tsc -b --noEmit",
              "cd frontend && npx eslint src/",
              "cd frontend && npx prettier --check src/",
              "cd frontend && CI=1 npx vitest run --project=unit",
              "cd frontend && npm run build-storybook"
            ],
            "fix_strategy": "If any check fails, fix the issue in the relevant source files before marking complete"
          },
          "verification": {
            "type": "command",
            "command": "cd frontend && npm run preflight:local",
            "expected": "All preflight checks pass"
          },
          "status": "completed",
          "notes": "All preflight checks pass: ESLint ✓, TypeScript ✓, 892 unit tests ✓, Storybook build ✓. No regressions.",
          "updated_at": "2026-02-24T11:11:56.793510+00:00"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 7,
    "total_subtasks": 9,
    "services_involved": [
      "frontend"
    ],
    "parallelism": {
      "max_parallel_phases": 4,
      "parallel_groups": [
        {
          "phases": [
            "phase-2-actionrow-integration",
            "phase-3-projecttree-integration",
            "phase-4-referencerow-integration",
            "phase-5-appheader-chatinput-integration"
          ],
          "reason": "All depend only on phase-1, each modifies different component files — no file conflicts"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Single service (frontend) — sequential execution recommended to avoid merge conflicts in shared test utilities"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 004 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "low",
    "skip_validation": false,
    "test_creation_phase": "inline_with_implementation",
    "test_types_required": [
      "unit",
      "integration"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All 8 Tooltip unit tests pass",
      "All tooltip integration tests pass (ActionRow 5, ProjectTree 3, AppHeader 4)",
      "All existing tests still pass (no regressions)",
      "TypeScript compiles without errors (npx tsc -b --noEmit)",
      "ESLint passes (npx eslint src/)",
      "Prettier passes (npx prettier --check src/)",
      "Storybook builds without errors (npm run build-storybook)",
      "All 4 Tooltip stories render correctly in Storybook"
    ],
    "verification_steps": [
      {
        "name": "TypeScript Compilation",
        "command": "cd frontend && npx tsc -b --noEmit",
        "expected_outcome": "No type errors",
        "type": "command",
        "required": true,
        "blocking": true
      },
      {
        "name": "ESLint",
        "command": "cd frontend && npx eslint src/",
        "expected_outcome": "No linting errors",
        "type": "command",
        "required": true,
        "blocking": true
      },
      {
        "name": "Prettier",
        "command": "cd frontend && npx prettier --check src/",
        "expected_outcome": "All files formatted correctly",
        "type": "command",
        "required": true,
        "blocking": true
      },
      {
        "name": "Unit Tests",
        "command": "cd frontend && CI=1 npx vitest run --project=unit",
        "expected_outcome": "All tests pass including new Tooltip and integration tests",
        "type": "command",
        "required": true,
        "blocking": true
      },
      {
        "name": "Storybook Build",
        "command": "cd frontend && npm run build-storybook",
        "expected_outcome": "Storybook builds successfully with new Tooltip stories",
        "type": "command",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "Low risk, single-service, purely additive UI change. Unit tests for new component + integration tests for modified components provide sufficient coverage. No security concerns (no auth, no data, no APIs)."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "cd frontend && CI=1 npx vitest run --project=unit"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": false,
      "commands": [],
      "services_to_test": []
    },
    "e2e_tests": {
      "required": false,
      "commands": [],
      "flows": []
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://copilot.localhost:6006/?path=/story/primitives-tooltip--default",
          "checks": [
            "Tooltip renders above trigger on hover",
            "Shows 'Archive' text"
          ]
        },
        {
          "url": "http://copilot.localhost:6006/?path=/story/primitives-tooltip--derived-from-aria-label",
          "checks": [
            "Tooltip text derived from aria-label='Star project'"
          ]
        },
        {
          "url": "http://copilot.localhost:6006/?path=/story/primitives-tooltip--bottom-placement",
          "checks": [
            "Tooltip renders below trigger"
          ]
        },
        {
          "url": "http://copilot.localhost:6006/?path=/story/primitives-tooltip--icon-button-row",
          "checks": [
            "Each icon button shows its own tooltip on hover"
          ]
        }
      ]
    },
    "database_verification": {
      "required": false,
      "checks": []
    }
  },
  "qa_signoff": null,
  "last_updated": "2026-02-24T11:11:56.793524+00:00",
  "reviewReason": "completed"
}